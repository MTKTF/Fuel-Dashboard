<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuel Usage Report</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="data.js?v=123"></script>
</head>
<body>
    <h1>Fuel Usage Report</h1>

    <div class="nav-container">
        <button onclick="window.location.href='index.html'">üè† Home</button>
        <button onclick="window.location.href='fuel.html'">‚õΩ Fuel Transactions</button>
    </div>

    <div class="filter-container">
        <label for="keyfob-filter">Select Keyfob:</label>
        <select id="keyfob-filter" onchange="filterMPG()">
            <option value="">All Keyfobs</option>
        </select>
    </div>

    <div class="chart-container">
        <canvas id="mpgChart"></canvas>
    </div>

    <table>
        <thead>
            <tr>
                <th>Keyfob ID</th>
                <th>Fuel Pumped (L)</th>
                <th>Distance Traveled (Miles)</th>
                <th>MPG</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody id="reportLog"></tbody>
    </table>

    <script>
        function populateKeyfobDropdown() {
            const keyfobs = [...new Set(getDummyData().map(entry => entry.keyfob_id))];
            const dropdown = document.getElementById("keyfob-filter");

            keyfobs.forEach(keyfob => {
                const option = document.createElement("option");
                option.value = keyfob;
                option.textContent = keyfob;
                dropdown.appendChild(option);
            });
        }

        function filterMPG() {
            const selectedKeyfob = document.getElementById("keyfob-filter").value;
            const data = getDummyData().filter(entry => selectedKeyfob === "" || entry.keyfob_id === selectedKeyfob);

            document.getElementById('reportLog').innerHTML = data.map(entry => {
                const mpg = (entry.distance_traveled / (entry.fuel_pumped / 4.546)).toFixed(2); // Convert liters to gallons
                return `<tr>
                    <td>${entry.keyfob_id}</td>
                    <td>${entry.fuel_pumped} L</td>
                    <td>${entry.distance_traveled} miles</td>
                    <td>${mpg} MPG</td>
                    <td>${entry.timestamp}</td>
                </tr>`;
            }).join('');

            updateMPGChart(data);
        }

        function updateMPGChart(filteredData) {
            const timestamps = filteredData.map(entry => entry.timestamp);
            const mpgValues = filteredData.map(entry => (entry.distance_traveled / (entry.fuel_pumped / 4.546)).toFixed(2));

            mpgChart.data.labels = timestamps;
            mpgChart.data.datasets[0].data = mpgValues;
            mpgChart.update();
        }

        const mpgCtx = document.getElementById('mpgChart').getContext('2d');
        const mpgChart = new Chart(mpgCtx, {
            type: 'line',
            data: { labels: [], datasets: [{ label: 'MPG Over Time', data: [], borderColor: 'orange', fill: false }] },
            options: { responsive: true }
        });

        window.onload = () => {
            populateKeyfobDropdown();
            filterMPG();
        };
    </script>
</body>
</html>

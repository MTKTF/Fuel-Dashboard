<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuel Usage Report</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="data.js?v=123"></script>
</head>
<body>
    <h1>Fuel Usage Report</h1>

    <div class="nav-container">
        <button onclick="window.location.href='index.html'">üè† Home</button>
        <button onclick="window.location.href='fuel.html'">‚õΩ Fuel Transactions</button>
    </div>

    <div class="chart-container">
        <canvas id="weeklyUsageChart"></canvas>
    </div>

    <table>
        <thead>
            <tr>
                <th>Keyfob ID</th>
                <th>Fuel Pumped (L)</th>
                <th>Tank Level (L)</th>
                <th>Timestamp</th>
            </tr>
        </thead>
        <tbody id="reportLog"></tbody>
    </table>

    <button onclick="exportToCSV()">üìÇ Export to CSV</button>

    <script>
        function fetchReportData() {
            const data = getDummyData();
            const keyfobs = data.map(entry => entry.keyfob_id);
            const fuelAmounts = data.map(entry => entry.fuel_pumped);
            
            new Chart(document.getElementById('weeklyUsageChart').getContext('2d'), {
                type: 'bar',
                data: { labels: keyfobs, datasets: [{ label: 'Fuel Pumped (L)', data: fuelAmounts, backgroundColor: 'purple' }] },
                options: { responsive: true }
            });

            document.getElementById('reportLog').innerHTML = data.map(entry => 
                `<tr><td>${entry.keyfob_id}</td><td>${entry.fuel_pumped} L</td><td>${entry.tank_level} L</td><td>${entry.timestamp}</td></tr>`
            ).join('');
        }

        function exportToCSV() {
            let csvContent = "data:text/csv;charset=utf-8,Keyfob ID,Fuel Pumped (L),Tank Level (L),Timestamp\n";
            csvContent += Array.from(document.querySelectorAll("#reportLog tr")).map(row => 
                Array.from(row.children).map(cell => cell.textContent).join(",")
            ).join("\n");

            const link = document.createElement("a");
            link.href = encodeURI(csvContent);
            link.download = "fuel_report.csv";
            document.body.appendChild(link);
            link.click();
        }

        window.onload = fetchReportData;
    </script>
</body>
</html>
